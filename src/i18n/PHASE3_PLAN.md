# Phase 3 详细实施计划

**日期:** 2026-02-01  
**目标:** 完善 i18n 基础设施，创建工具脚本，迁移关键文件

---

## 1. 当前状态分析

### 1.1 已完成 (Phase 1 & 2)

- ✅ **i18n 基础设施:** 完整
- ✅ **已迁移文件:** 12 个核心文件
- ✅ **翻译键:** 205 个 (中英文完全匹配)
- ✅ **核心功能:** CLI、向导、配对已汉化

### 1.2 剩余工作

- ⏳ **未迁移描述:** ~106 个 `.description()` 调用
- ⏳ **未迁移文件:** ~50 个 CLI 文件
- ⏳ **工具脚本:** 需要提取和验证脚本
- ⏳ **文档:** 需要完善的使用文档

---

## 2. Phase 3 任务清单

### 2.1 创建工具脚本 (2个)

#### 2.1.1 提取脚本 `src/i18n/scripts/extract-i18n-keys.ts`

**功能:**

- 自动扫描源代码中的硬编码文本
- 识别 `.description()`, `message:`, `label:`, `text:` 等模式
- 生成缺失翻译键的报告
- 提供建议的翻译键名

**输入:**

- `src/**/*.ts` 文件

**输出:**

- Markdown 或 JSON 格式的报告
- 包含文件名、行号、建议键名

**示例输出:**

```markdown
| Type        | Text                    | File                   | Line | Suggested Key                |
| ----------- | ----------------------- | ---------------------- | ---- | ---------------------------- |
| description | List discovered plugins | src/cli/plugins-cli.ts | 112  | cli.plugins.list.description |
```

#### 2.1.2 验证脚本 `src/i18n/scripts/validate.ts`

**功能:**

- 验证中英文翻译键是否完全匹配
- 检查是否有重复的键
- 检查是否有空值
- 生成验证报告

**检查项:**

- [ ] 英文键数 == 中文键数
- [ ] 所有英文键都有对应的中文键
- [ ] 没有空字符串值
- [ ] 键名格式符合规范

### 2.2 完善文档 (2个)

#### 2.2.1 使用文档 `src/i18n/USAGE.md`

**内容:**

1. 快速开始
2. 在代码中使用翻译
3. 添加新的翻译键
4. 切换语言
5. 最佳实践

#### 2.2.2 示例文件 `src/i18n/examples/basic-usage.ts`

**展示:**

- 基础翻译用法
- 插值用法
- 切换语言
- 错误处理

### 2.3 迁移更多关键文件 (可选)

**高优先级:**

- `src/cli/channels-cli.ts` - 9 个描述
- `src/cli/config-cli.ts` - 4 个描述
- `src/cli/memory-cli.ts` - 5 个描述
- `src/cli/security-cli.ts` - 2 个描述

**中优先级:**

- `src/cli/models-cli.ts` - 28 个描述
- `src/cli/cron-cli/*.ts` - 10 个描述
- `src/cli/program/register.*.ts` - 20+ 个描述

---

## 3. 实施顺序

### 第1步: 创建验证脚本 (30分钟)

- 实现 `validate.ts`
- 验证当前翻译键的完整性
- 修复发现的问题

### 第2步: 创建提取脚本 (45分钟)

- 实现 `extract-i18n-keys.ts`
- 运行脚本，生成报告
- 验证脚本准确性

### 第3步: 完善文档 (30分钟)

- 编写 `USAGE.md`
- 创建示例文件
- 添加 JSDoc 注释

### 第4步: 迁移关键文件 (60分钟)

- 迁移 channels-cli.ts
- 迁移 config-cli.ts
- 迁移 memory-cli.ts
- 迁移 security-cli.ts

### 第5步: 最终验证 (15分钟)

- 运行所有脚本
- 验证翻译完整性
- 更新统计报告

---

## 4. 预期成果

### 4.1 工具脚本

```bash
# 验证翻译完整性
pnpm tsx src/i18n/scripts/validate.ts

# 提取缺失的翻译键
pnpm tsx src/i18n/scripts/extract-i18n-keys.ts
pnpm tsx src/i18n/scripts/extract-i18n-keys.ts --format=json --output=missing.json
```

### 4.2 文档

- ✅ `src/i18n/USAGE.md` - 完整的使用指南
- ✅ `src/i18n/examples/basic-usage.ts` - 代码示例
- ✅ 所有脚本都有详细的 JSDoc 注释

### 4.3 新增翻译

- **新增翻译键:** ~50 个 (来自关键文件)
- **总翻译键数:** 从 205 增加到 ~255 个
- **覆盖率:** 核心 CLI 100% 汉化

---

## 5. 成功标准

### 5.1 工具脚本

- [ ] `validate.ts` 能正确检查中英文匹配
- [ ] `extract-i18n-keys.ts` 能准确提取硬编码文本
- [ ] 脚本都有 `--help` 或清晰的用法说明
- [ ] 脚本错误处理完善

### 5.2 文档

- [ ] `USAGE.md` 包含完整的用法说明
- [ ] 示例文件能独立运行
- [ ] 所有公共 API 都有 JSDoc

### 5.3 迁移质量

- [ ] 新增文件都正确导入 `t()` 函数
- [ ] 所有翻译键都有中英文版本
- [ ] 键名符合命名规范
- [ ] 插值使用正确

---

## 6. 时间安排

| 任务         | 预计时间     | 优先级 |
| ------------ | ------------ | ------ |
| 创建验证脚本 | 30 分钟      | 高     |
| 创建提取脚本 | 45 分钟      | 高     |
| 完善文档     | 30 分钟      | 高     |
| 迁移关键文件 | 60 分钟      | 中     |
| 最终验证     | 15 分钟      | 高     |
| **总计**     | **2.5 小时** | -      |

---

## 7. 下一步 (Phase 4)

Phase 3 完成后，可选进行:

1. **批量迁移剩余文件** - 使用提取脚本自动迁移
2. **添加更多语言** - 如繁体中文、日语等
3. **优化性能** - 懒加载语言包
4. **添加 CI 检查** - 防止遗漏翻译

---

**准备开始 Phase 3 实施！**
