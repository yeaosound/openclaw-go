# apps/macos/Sources/ Knowledge Base

## OVERVIEW

`apps/macos/Sources/` is Swift source for the macOS app, supporting modules, and generated protocol models.
Inherit packaging/signing workflow from `apps/macos/AGENTS.md`; this file is source-tree delta only.

## STRUCTURE

- `OpenClaw/`: main menu bar app code (state, settings, gateway integration, UI).
- `OpenClawProtocol/`: generated gateway protocol Swift models.
- `OpenClawMacCLI/`: Swift CLI helpers.
- `OpenClawDiscovery/`, `OpenClawIPC/`: discovery and IPC support modules.

## WHERE TO LOOK

- App-wide persisted state + defaults wiring: `OpenClaw/AppState.swift`.
- Gateway protocol model updates: `OpenClawProtocol/GatewayModels.swift` (generated).
- Menu/settings behavior: `OpenClaw/MenuBar.swift`, settings-related files in `OpenClaw/`.
- Onboarding-specific screens: `OpenClaw/OnboardingView+*.swift`.

## CONVENTIONS

- `OpenClawProtocol/GatewayModels.swift` is generated by `scripts/protocol-gen-swift.ts`; do not hand edit.
- Validate protocol sync from repo root with `pnpm protocol:check`.
- Keep UserDefaults keys and migration paths stable when changing persisted settings.
- Keep platform packaging/signing logic in scripts, not in Swift source.

## ANTI-PATTERNS

- Manual edits to generated protocol models.
- Introducing settings state without persistence/migration review.
- Coupling UI behavior to packaging environment assumptions.
- Mixing cross-module concerns when a dedicated module (`OpenClawIPC`, `OpenClawDiscovery`) already exists.
